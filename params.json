{
  "name": "Mailgun-js",
  "tagline": "A simple Node.js helper module for Mailgun API.",
  "body": "# mailgun.js\r\n\r\nSimple Node.js module for [Mailgun](http://www.mailgun.com).\r\n\r\n[![NPM](https://nodei.co/npm/mailgun-js.png?downloads=true&stars=true)](https://nodei.co/npm/mailgun-js/)\r\n\r\n[![NPM](https://nodei.co/npm-dl/mailgun-js.png)](https://nodei.co/npm/mailgun-js/)\r\n\r\n## Installation\r\n\r\n`npm install mailgun-js`\r\n\r\n## Usage overview\r\n\r\nPlease see [Mailgun Documentation](https://documentation.mailgun.com) for full Mailgun API reference.\r\n\r\nThis module works by providing proxy objects for interacting with different resources through the Mailgun API.\r\nMost methods take a `data` parameter, which is a Javascript object that would contain the arguments for the Mailgun API.\r\nAll methods take a final parameter callback with two parameters: `error`, and `body`.\r\nWe try to parse the `body` into a javascript object, and return it to the callback as such for easier use and inspection by the client.\r\nIf there was an error a new `Error` object will be passed to the callback in the `error` parameter.\r\nIf the error originated from the (Mailgun) server, the response code will be available in the `statusCode` property\r\nof the `error` object passed in the callback.\r\nSee the `/docs` folder for detailed documentation. For full usage examples see the `/test` folder.\r\n\r\n```js\r\nvar api_key = 'key-XXXXXXXXXXXXXXXXXXXXXXX';\r\nvar domain = 'mydomain.mailgun.org';\r\nvar mailgun = require('mailgun-js')({apiKey: api_key, domain: domain});\r\n\r\nvar data = {\r\n  from: 'Excited User <me@samples.mailgun.org>',\r\n  to: 'serobnic@mail.ru',\r\n  subject: 'Hello',\r\n  text: 'Testing some Mailgun awesomness!'\r\n};\r\n\r\nmailgun.messages().send(data, function (error, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\nMessages stored using the Mailgun `store()` action can be retrieved using `messages(<message_key>).info()` function.\r\nOptionally the MIME representation of the message can be retrieved if `MIME` argument is passed in and set to `true`.\r\n\r\nSomething more elaborate. Get mailing list info, create a member and get mailing list members and update member.\r\nNotice that the proxy objects can be reused.\r\n\r\n```js\r\nvar list = mailgun.lists('mylist@mycompany.com');\r\n\r\nlist.info(function (err, data) {\r\n  // `data` is mailing list info\r\n  console.log(data);\r\n});\r\n\r\nvar bob = {\r\n  subscribed: true,\r\n  address: 'bob@gmail.com',\r\n  name: 'Bob Bar',\r\n  vars: {age: 26}\r\n};\r\n\r\nlist.members().create(bob, function (err, data) {\r\n  // `data` is the member details\r\n  console.log(data);\r\n});\r\n\r\nlist.members().list(function (err, members) {\r\n  // `members` is the list of members\r\n  console.log(members);\r\n});\r\n\r\nlist.members('bob@gmail.com').update({ name: 'Foo Bar' }, function (err, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\n#### Options\r\n\r\n`Mailgun` object constructor options:\r\n\r\n* `apiKey` - Your Mailgun API KEY\r\n* `domain` - Your Mailgun Domain\r\n* `mute` - Set to `true` if you wish to mute the console error logs in `validateWebhook()` function\r\n* `proxy` - The proxy URI in format `http[s]://[auth@]host:port`. ex: `'http://proxy.example.com:8080'`\r\n* `timeout` - Request timeout in milliseconds\r\n* `host` - the mailgun host (default: 'api.mailgun.net')\r\n* `protocol` - the mailgun protocol (default: 'https:', possible values: 'http:' or 'https:')\r\n* `port` - the mailgun port (default: '443')\r\n* `endpoint` - the mailgun host (default: '/v3')\r\n* `retry` - the number of **total attempts** to do when performing requests. Default is `1`. \r\nThat is, we will try an operation only once with no retries on error.\r\n          \r\n\r\n#### Attachments\r\n\r\nAttachments can be sent using either the `attachment` or `inline` parameters. `inline` parameter can be use to send an\r\nattachment with `inline` disposition. It can be used to send inline images. Both types are supported with same mechanisms\r\nas described, we will just use `attachment` parameter in the documentation below but same stands for `inline`.\r\n\r\nSending attachments can be done in a few ways. We can use the path to a file in the `attachment` parameter.\r\nIf the `attachment` parameter is of type `string` it is assumed to be the path to a file.\r\n\r\n```js\r\nvar filepath = path.join(__dirname, 'mailgun_logo.png');\r\n\r\nvar data = {\r\n  from: 'Excited User <me@samples.mailgun.org>',\r\n  to: 'serobnic@mail.ru',\r\n  subject: 'Hello',\r\n  text: 'Testing some Mailgun awesomness!',\r\n  attachment: filepath\r\n};\r\n\r\nmailgun.messages().send(data, function (error, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\nWe can pass a buffer (has to be a `Buffer` object) of the data. If a buffer is used the data will be attached using a\r\ngeneric filename \"file\".\r\n\r\n```js\r\nvar filepath = path.join(__dirname, 'mailgun_logo.png');\r\nvar file = fs.readFileSync(filepath);\r\n\r\nvar data = {\r\n  from: 'Excited User <me@samples.mailgun.org>',\r\n  to: 'serobnic@mail.ru',\r\n  subject: 'Hello',\r\n  text: 'Testing some Mailgun awesomness!',\r\n  attachment: file\r\n};\r\n\r\nmailgun.messages().send(data, function (error, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\nWe can also pass in a stream of the data. This is useful if you're attaching a file from the internet.\r\n\r\n```js\r\nvar request = require('request');\r\nvar file = request(\"https://www.google.ca/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png\");\r\n\r\nvar data = {\r\n  from: 'Excited User <me@samples.mailgun.org>',\r\n  to: 'serobnic@mail.ru',\r\n  subject: 'Hello',\r\n  text: 'Testing some Mailgun awesomness!',\r\n  attachment: file\r\n};\r\n\r\nmailgun.messages().send(data, function (error, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\nFinally we provide a `Mailgun.Attachment` class to add attachments with a bit more customization. The Attachment\r\nconstructor takes an `options` object. The `options` parameters can have the following fields:\r\n* `data` - can be one of\r\n    * a string representing file path to the attachment\r\n    * a buffer of file data\r\n    * an instance of `Readable` which means it is a readable stream.\r\n* `filename` - the file name to be used for the attachment. Default is 'file'\r\n* `contentType` - the content type. Required for case of `Readable` data. Ex. `image/jpg`.\r\n* `knownLength` - the content length in bytes. Required for case of `Readable` data.\r\n\r\nIf an attachment object does not satisfy those valid conditions it is ignored. Multiple attachments can be sent by\r\npassing an array in the `attachment` parameter. The array elements can be of any one of the valid types and each one\r\nwill be handled appropriately.\r\n\r\n```js\r\nvar mailgun = require('mailgun-js')({apiKey: api_key, domain: domain});\r\nvar filename = 'mailgun_logo.png';\r\nvar filepath = path.join(__dirname, filename);\r\nvar file = fs.readFileSync(filepath);\r\n\r\nvar attch = new mailgun.Attachment({data: file, filename: filename});\r\n\r\nvar data = {\r\n  from: 'Excited User <me@samples.mailgun.org>',\r\n  to: 'serobnic@mail.ru',\r\n  subject: 'Hello',\r\n  text: 'Testing some Mailgun awesomness!',\r\n  attachment: attch\r\n};\r\n\r\nmailgun.messages().send(data, function (error, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\n```js\r\nvar mailgun = require('mailgun-js')({apiKey: api_key, domain: domain});\r\nvar filename = 'mailgun_logo.png';\r\nvar filepath = path.join(__dirname, filename);\r\nvar fileStream = fs.createReadStream(filepath);\r\nvar fileStat = fs.statSync(filepath);\r\n\r\nmsg.attachment = new mailgun.Attachment({\r\n  data: fileStream,\r\n  filename: 'my_custom_name.png',\r\n  knownLength: fileStat.size,\r\n  contentType: 'image/png'});\r\n\r\nmailgun.messages().send(data, function (error, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\n#### Sending MIME messages\r\n\r\nSending messages in MIME format can be accomplished using the `sendMime()` function of the `messages()` proxy object.\r\nThe `data` parameter for the function has to have `to` and `message` properties. The `message` property can be a full\r\nfile path to the MIME file, a stream of the file (that is a `Readable` object), or a string representation of the MIME\r\nmessage. To build a MIME string you can use the [Mail Composer] (https://www.npmjs.org/package/mailcomposer) library.\r\nSome examples:\r\n\r\n```js\r\nvar domain = 'mydomain.mailgun.org';\r\nvar mailgun = require('mailgun-js')({ apiKey: \"YOUR API KEY\", domain: domain });\r\nvar mailcomposer = require('mailcomposer');\r\n\r\nvar mail = mailcomposer({\r\n  from: 'you@samples.mailgun.org',\r\n  to: 'mm@samples.mailgun.org',\r\n  subject: 'Test email subject',\r\n  body: 'Test email text',\r\n  html: '<b> Test email text </b>'\r\n});\r\n\r\nmail.build(function(mailBuildError, message) {\r\n\r\n    var dataToSend = {\r\n        to: 'mm@samples.mailgun.org',\r\n        message: message.toString('ascii')\r\n    };\r\n\r\n    mailgun.messages().sendMime(dataToSend, function (sendError, body) {\r\n        if (sendError) {\r\n            console.log(sendError);\r\n            return;\r\n        }\r\n    });\r\n});\r\n```\r\n#### Referencing MIME file\r\n\r\n```js\r\nvar filepath = '/path/to/message.mime';\r\n\r\nvar data = {\r\n  to: fixture.message.to,\r\n  message: filepath\r\n};\r\n\r\nmailgun.messages().sendMime(data, function (err, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\n```js\r\nvar filepath = '/path/to/message.mime';\r\n\r\nvar data = {\r\n  to: fixture.message.to,\r\n  message: fs.createReadStream(filepath)\r\n};\r\n\r\nmailgun.messages().sendMime(data, function (err, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\n#### Creating mailing list members\r\n\r\n`members().create({data})` will create a mailing list member with `data`. Mailgun also offers a resource for creating\r\nmembers in bulk. Doing a `POST` to `/lists/<address>/members.json` adds multiple members, up to 1,000 per call,\r\nto a Mailing List. This can be accomplished using `members().add()`.\r\n\r\n```js\r\nvar members = [\r\n  {\r\n    address: 'Alice <alice@example.com>',\r\n    vars: { age: 26 }\r\n  },\r\n  {\r\n    name: 'Bob',\r\n    address: 'bob@example.com',\r\n    vars: { age: 34 }\r\n  }\r\n];\r\n\r\nmailgun.lists('mylist@mycompany.com').members().add({ members: members, subscribed: true }, function (err, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\n## Generic requests\r\n\r\nMailgun-js also provides helper methods to allow users to interact with parts of the api that are not exposed already.\r\nThese are not tied to the domain passed in the constructor, and thus require the full path with the domain\r\npassed in the `resource` argument.\r\n\r\n* `mailgun.get(resource, data, callback)` - sends GET request to the specified resource on api.\r\n* `mailgun.post(resource, data, callback)` - sends POST request to the specified resource on api.\r\n* `mailgun.delete(resource, data, callback)` - sends DELETE request to the specified resource on api.\r\n* `mailgun.put(resource, data, callback)` - sends PUT request to the specified resource on api.\r\n\r\nExample: Get some stats\r\n\r\n```js\r\nmailgun.get('/samples.mailgun.org/stats', { event: ['sent', 'delivered'] }, function (error, body) {\r\n  console.log(body);\r\n});\r\n```\r\n\r\n## Promises\r\n\r\nModule works with Node-style callbacks, but also implements promises with the [Q](http://github.com/kriskowal/q) library.\r\n\r\n```js\r\nmailgun.lists('mylist@mydomain.com').info().then(function (data) {\r\n  console.log(data);\r\n}, function (err) {\r\n  console.log(err);\r\n});\r\n```\r\n\r\nThe function passed as 2nd argument is optional and not needed if you don't care about the fail case.\r\n\r\n## Webhook validation\r\n\r\nThe Mailgun object also has a helper function for validating Mailgun Webhook requests\r\n(as per the [mailgun docs for securing webhooks](http://documentation.mailgun.com/user_manual.html#securing-webhooks)).\r\nThis code came from [this gist](https://gist.github.com/coolaj86/81a3b61353d2f0a2552c).\r\n\r\nExample usage:\r\n\r\n```js\r\nvar mailgun = require('mailgun-js')({apiKey: api_key, domain: domain});\r\n\r\nfunction router(app) {\r\n  app.post('/webhooks/mailgun/*', function (req, res, next) {\r\n    var body = req.body;\r\n\r\n    if (!mailgun.validateWebhook(body.timestamp, body.token, body.signature)) {\r\n      console.error('Request came, but not from Mailgun');\r\n      res.send({ error: { message: 'Invalid signature. Are you even Mailgun?' } });\r\n      return;\r\n    }\r\n\r\n    next();\r\n  });\r\n\r\n  app.post('/webhooks/mailgun/catchall', function (req, res) {\r\n    // actually handle request here\r\n  });\r\n}\r\n```\r\n\r\n## Tests\r\n\r\nTo run the test suite you must first have a Mailgun account with a domain setup. Then create a file named _./test/auth.json_, which contains your credentials as JSON, for example:\r\n\r\n```json\r\n{ \"api_key\": \"key-XXXXXXXXXXXXXXXXXXXXXXX\", \"domain\": \"mydomain.mailgun.org\" }\r\n```\r\n\r\nYou should edit _./test/fixture.json_ and modify the data to match your context.\r\n\r\nThen install the dev dependencies and execute the test suite:\r\n\r\n```\r\n$ npm install\r\n$ npm test\r\n```\r\n\r\nThe tests will call Mailgun API, and will send a test email, create route(s), mailing list and mailing list member.\r\n\r\n## Notes\r\n\r\nThis project is not endorsed by or affiliated with [Mailgun](http://www.mailgun.com).\r\nThe general design and some code was heavily inspired by [node-heroku-client](https://github.com/jclem/node-heroku-client).\r\n\r\n## License\r\n\r\nCopyright 2012, 2013, 2014 OneLobby\r\n\r\nLicensed under the MIT License.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}